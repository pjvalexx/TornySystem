{% extends 'public/base_cpanel.html' %}
{% block title %}Gestionar Órdenes de Trabajo{% endblock %}
{% block body %}
{% if (ordenes) %}
<div class="card content_consignaciones" style="border-radius: 0px !important">
  <section id="respuestaFiltroMes">
    <h2 class="text-center mt-5 mb-5">
      Gestionar Órdenes de Trabajo
      <hr />
    </h2>
    <div class="table-responsive text-nowrap">
      <table class="table table-hover">
        <thead>
          <tr style="background-color: #ddd">
            <th>ID</th>
            <th>Cliente</th>
            <th>Tipo de Servicio</th>
            <th>Descripción</th>
            <th>Fecha de Entrega</th>
            <th>Materiales</th>
            <th>Monto</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          {% for orden in ordenes %}
          <tr>
            <td>{{ orden.id }}</td>
            <td>{{ orden.client_name }}</td>
            <td>{{ orden.service_type }}</td>
            <td>{{ orden.description }}</td>
            <td>{{ orden.delivery_date }}</td>
            <td>{{ orden.materials }}</td>
            <td>{{ orden.amount }}</td>
            <td>
              <span class="badge {% if orden.status == 'Pendiente' %}bg-warning{% elif orden.status == 'En Proceso' %}bg-orange{% elif orden.status == 'Completado' %}bg-primary{% elif orden.status == 'Entregado' %}bg-success{% elif orden.status == 'Cancelado' %}bg-danger{% endif %}">
                {{ orden.status }}
              </span>
            </td>
            <td>
              <a href="/editar-orden/{{ orden.id }}" class="btn btn-success btn-sm">Editar</a>
              <button class="btn rounded-pill btn-danger" onclick="eliminarOrden('{{ orden.id }}');">Eliminar</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% else %}
<div class="container mt-3 mb-3" style="width: 100% !important">
  <div class="row justify-content-md-center mb-2">
    <div class="col-12">
      <h2 class="text-center">No hay órdenes de trabajo 😭</h2>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
{% block customJS %}
<script>
  function eliminarOrden(id) {
    if (confirm("¿Estás seguro que deseas eliminar la orden de trabajo?")) {
      let url = `/borrar-orden/${id}`;
      if (url) {
        window.location.href = url;
      }
    }
  }
</script>
{% endblock %}